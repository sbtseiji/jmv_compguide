{"version":3,"sources":["../src/1.1.5.js"],"names":["module","exports","context","Syntax","RuleError","report","getSource","desumasuList","dearuList","resetState","imagePaddingLet","reportResult","list","desumasu","dearu","forEach","node","matches","match","message","value","line","lineNumber","column","columnIndex","Document","Image","text","alt","undefined","retDesumasu","length","push","retDearu","desumasuCount","reduce","count","dearuCount"],"mappings":"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","sourcesContent":["// LICENSE : MIT\n\"use strict\";\n/*\n1.1.5.図表のキャプション\n文章の内容に応じて、敬体、常体、体言止めを使います。\nいずれの場合も、複数の文体をできるだけ混在させないことが重要です。\n通常、文末に句点(。)を付けませんが、複数の文章になる場合は句点を使用します。\n\nキャプション間で文体が混ざっていないことを確認する。\n */\nimport { analyzeDesumasu, analyzeDearu } from \"analyze-desumasu-dearu\";\nmodule.exports = function (context) {\n    let { Syntax, RuleError, report, getSource } = context;\n    let desumasuList = [];\n    let dearuList = [];\n\n    function resetState() {\n        desumasuList = [];\n        dearuList = [];\n    }\n\n    const imagePaddingLet = 2; // ![ の分paddingを付ける\n    function reportResult(list, { desumasu, dearu }) {\n        list.forEach(({ node, matches }) => {\n            matches.forEach((match) => {\n                let message;\n                if (desumasu) {\n                    message = `図表のキャプションを敬体(ですます調)に統一して下さい。\\n図表のキャプション内で敬体、常体を混在させないことが重要です。\\n\"${match.value}\"が常体(である調)です。`;\n                } else if (dearu) {\n                    message = `図表のキャプションを常体(である調)に統一して下さい。\\n図表のキャプション内で敬体、常体を混在させないことが重要です。\\n\"${match.value}\"が敬体(ですます調)です。`;\n                }\n                report(\n                    node,\n                    new RuleError(message, {\n                        line: match.lineNumber - 1,\n                        column: match.columnIndex + imagePaddingLet\n                    })\n                );\n            });\n        });\n    }\n\n    return {\n        [Syntax.Document]: resetState,\n        [Syntax.Image](node) {\n            let text = node.alt;\n            // alt がない場合は無視する\n            if (text === undefined || text === null) {\n                return;\n            }\n            let retDesumasu = analyzeDesumasu(text);\n            if (retDesumasu.length > 0) {\n                desumasuList.push({\n                    node: node,\n                    matches: retDesumasu\n                });\n            }\n            let retDearu = analyzeDearu(text);\n            if (retDearu.length > 0) {\n                dearuList.push({\n                    node: node,\n                    matches: retDearu\n                });\n            }\n        },\n        [`${Syntax.Document}:exit`]() {\n            let desumasuCount = desumasuList.reduce((count, { matches }) => count + matches.length, 0);\n            let dearuCount = dearuList.reduce((count, { matches }) => count + matches.length, 0);\n            if (desumasuCount === 0 || dearuCount === 0) {\n                return;\n            }\n            if (desumasuCount > dearuCount) {\n                reportResult(dearuList, {\n                    desumasu: true\n                });\n            } else if (desumasuCount < dearuCount) {\n                reportResult(desumasuList, {\n                    dearu: true\n                });\n            } else {\n                reportResult(dearuList, {\n                    desumasu: true\n                });\n            }\n        }\n    };\n};\n"],"file":"1.1.5.js"}